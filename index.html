<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SOE - Peta Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      /* Custom styles for the map and points */
      html,
      body {
        height: 100%; /* Ensures html and body take full height initially */
        margin: 0;
        padding: 0;
        overflow-x: hidden; /* Prevents horizontal scrollbar on body unless necessary */
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: #f0f4f8; /* Light background */
        display: flex;
        flex-direction: column; /* Arranges content vertically */
        justify-content: flex-start; /* Aligns content to the top */
        align-items: center;
        /* Removed height: 100vh; and overflow: hidden; to allow natural scrolling */
        min-height: 100vh; /* Ensures at least viewport height */
        box-sizing: border-box;
      }

      .logo-container {
        position: fixed; /* Fixed position relative to the viewport */
        top: 20px;
        left: 20px;
        background-color: #ffffff; /* White background */
        padding: 10px;
        border-radius: 0.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        z-index: 1000; /* Ensures it floats above other content */
      }

      .logo-container img {
        height: 50px; /* Adjust logo height as needed */
        width: auto;
        display: block;
      }

      .map-wrapper {
        position: relative; /* Added for absolute positioning of controls */
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem; /* Space between map and buttons (now internal) */
        width: 100%;
        /* Removed height: 100vh; to allow content to dictate height */
        min-height: calc(
          100vh - 40px
        ); /* Minimum height to prevent collapse, accounting for some padding/margin */
        margin-bottom: 0; /* No need for margin as controls are floating */
        padding-top: 0; /* Removed padding-top as search bar is now absolute */
      }

      .search-bar {
        position: absolute; /* Changed to absolute */
        top: 20px;
        right: 20px; /* Positioned to top right */
        z-index: 990;
        background-color: #ffffff;
        padding: 10px; /* Adjusted padding */
        border-radius: 0.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 0.5rem;
        width: auto; /* Allow width to adjust */
        max-width: none; /* No max width for initial icon state */
        box-sizing: border-box;
        transition: width 0.3s ease-in-out, padding 0.3s ease-in-out; /* Add transition for expansion */
      }

      .search-bar.expanded {
        width: 90%; /* Expanded width */
        max-width: 500px; /* Max width when expanded */
      }

      .search-bar input {
        flex-grow: 1;
        padding: 0.5rem 0.75rem;
        border: 1px solid #e2e8f0;
        border-radius: 0.375rem;
        font-size: 1rem;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      }

      .search-bar button {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out, opacity 0.3s ease-in-out,
          visibility 0.3s ease-in-out;
        border: none;
      }

      .search-button {
        background-color: #3b82f6; /* Blue */
        color: white;
      }

      .search-button:hover {
        background-color: #2563eb; /* Darker blue */
      }

      .clear-search-button {
        background-color: #ef4444; /* Red */
        color: white;
      }

      .clear-search-button:hover {
        background-color: #dc2626; /* Darker red */
      }

      .search-icon-toggle {
        background-color: #3b82f6; /* Blue for the icon */
        color: white;
        width: 44px; /* Fixed width for the icon button */
        height: 44px; /* Fixed height for the icon button */
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%; /* Make it circular */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .search-icon-toggle:hover {
        background-color: #2563eb;
      }

      /* Classes to hide/show elements */
      .hidden {
        display: none;
        opacity: 0;
        visibility: hidden;
      }
      .visible-flex {
        display: flex;
        opacity: 1;
        visibility: visible;
      }
      .visible-block {
        display: block;
        opacity: 1;
        visibility: visible;
      }

      .map-container {
        position: relative;
        width: 100%; /* Takes full available width */
        height: auto; /* Allows height to be determined by content */
        min-height: 500px; /* Minimum height for visibility */
        max-height: 1920px; /* Added max height */
        border-radius: 0; /* Removed border-radius for full window effect */
        overflow: auto; /* Enables scrolling when content overflows */
        box-shadow: none; /* Removed shadow for full window effect */
        background-color: #ffffff;
        cursor: grab; /* Indicates draggable */
        user-select: none; /* Prevents text selection when dragging */
        -webkit-user-select: none; /* For Safari */
        -moz-user-select: none; /* For Firefox */
        -ms-user-select: none; /* For IE/Edge */
      }

      .map-content-wrapper {
        position: relative; /* Important for absolute positioning of points */
        /* Width and height will be set by JS based on zoom */
        transition: none; /* No transition on this for instant sizing */
        display: block; /* Ensures it behaves like a block element */
      }

      .map-image {
        width: 100%; /* Image scales with its parent map-content-wrapper */
        height: auto; /* Maintains aspect ratio */
        display: block; /* Removes extra space below image */
        border-radius: 0; /* Removed border-radius for full window effect */
        transition: none; /* No transition on image for layout changes */
      }

      .map-point {
        position: absolute;
        width: 48px; /* Reverted to original size */
        height: 48px; /* Reverted to original size */
        background-color: #ef4444; /* Red color, now background for image */
        border-radius: 0; /* Rectangular shape */
        cursor: pointer;
        border: 3px solid #ffffff; /* White border */
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5); /* Outer glow */
        transition: transform 0.2s ease-in-out,
          background-color 0.2s ease-in-out;
        transform: translate(
          -50%,
          -50%
        ); /* Centers the point on its coordinates */
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
        font-size: 0.8rem;
        overflow: hidden; /* Ensures image stays within bounds */
      }

      .map-point img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* Ensures entire image is visible */
        display: block;
      }

      .map-point:hover {
        transform: translate(-50%, -50%) scale(1.2); /* Enlarges on hover */
        background-color: #dc2626; /* Darker red on hover */
      }

      /* Style for circular points */
      .map-point.circle {
        border-radius: 50%; /* Makes the point circular */
      }

      .current-location-marker {
        position: absolute;
        width: 30px; /* Marker size */
        height: 30px;
        background-color: #3b82f6; /* Blue color for current location */
        border-radius: 50%; /* Circular shape */
        border: 4px solid #ffffff; /* White border */
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); /* Blue glow */
        transform: translate(
          -50%,
          -50%
        ); /* Centers the marker on its coordinates */
        animation: pulse 1.5s infinite ease-out; /* Pulsing animation */
        z-index: 50; /* Ensures it's above other points */
      }

      @keyframes pulse {
        0% {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 0.8;
        }
        50% {
          transform: translate(-50%, -50%) scale(1.1);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 0.8;
        }
      }

      .detail-card {
        position: fixed; /* Fixed position to overlay content */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%); /* Centers the card */
        background-color: #ffffff;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2); /* Stronger shadow for modal */
        z-index: 1000; /* Ensures it's on top */
        max-width: 400px; /* Max width for modal */
        width: 90%; /* Takes 90% of screen width on smaller screens */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        border: 1px solid #e2e8f0; /* Light border */
      }

      .detail-card.active {
        opacity: 1;
        visibility: visible;
      }

      .detail-card-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent overlay */
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-out, visibility 0.3s ease-in-out;
      }

      .detail-card-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .close-button {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #64748b; /* Gray color */
        transition: color 0.2s ease-in-out;
      }

      .close-button:hover {
        color: #1e293b; /* Darker gray on hover */
      }

      .action-button {
        background-color: #10b981; /* Green color */
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out,
          transform 0.1s ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: none;
        display: flex; /* Use flexbox for icon and text alignment */
        align-items: center;
        justify-content: center;
        gap: 0.5rem; /* Space between icon and text */
      }

      .action-button:hover {
        background-color: #059669; /* Darker green on hover */
        transform: translateY(-1px);
      }

      .action-button:active {
        transform: translateY(1px);
      }

      .action-button:disabled {
        background-color: #a0aec0; /* Lighter gray when disabled */
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }

      .loading-spinner {
        border: 4px solid #f3f3f3; /* Light gray */
        border-top: 44px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
        display: none; /* Hidden by default */
        margin: 0 auto; /* Centers the spinner */
      }

      .loading-spinner.active {
        display: block;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .detail-image {
        width: 100%;
        height: 180px; /* Fixed height for consistency */
        object-fit: cover; /* Covers the area, cropping if necessary */
        border-radius: 0.5rem;
        margin-bottom: 1rem;
      }

      .social-links {
        display: flex;
        flex-wrap: wrap; /* Allows links to wrap on smaller screens */
        gap: 0.75rem;
        margin-top: 0.5rem;
      }

      .social-link {
        color: #3b82f6; /* Blue color for links */
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s ease-in-out;
      }

      .social-link:hover {
        color: #2563eb; /* Darker blue on hover */
      }

      .phone-number {
        font-size: 1rem;
        color: #475569; /* Slate gray */
        margin-top: 0.5rem;
      }

      .zoom-controls {
        position: absolute; /* Changed to absolute */
        bottom: 40px; /* Adjusted to be slightly higher */
        right: 20px; /* Changed from left to right */
        display: flex;
        flex-direction: column; /* Stacks buttons vertically */
        gap: 0.5rem; /* Reduced gap for stacked buttons */
        background-color: rgba(
          255,
          255,
          255,
          0.9
        ); /* Semi-transparent background */
        padding: 10px; /* Adjusted padding */
        border-radius: 1rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        z-index: 900; /* Ensures it's above the map but below the modal */
      }

      .message-box {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        z-index: 1001;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      }

      .message-box.active {
        opacity: 1;
        visibility: visible;
      }

      /* Responsive adjustments for smaller screens */
      @media (max-width: 768px) {
        .map-point {
          width: 30px; /* Slightly smaller points on mobile */
          height: 30px;
          font-size: 0.7rem;
        }
        .detail-card {
          padding: 1.5rem; /* Less padding on mobile for more content space */
        }
        .detail-image {
          height: 150px; /* Slightly smaller image height on mobile */
        }
        .zoom-controls {
          flex-direction: column; /* Already column, but good to be explicit */
          gap: 0.5rem;
          bottom: 10px; /* Adjust bottom for smaller screens */
          right: 10px; /* Adjust right for smaller screens */
          padding: 8px;
        }
        .map-wrapper {
          /* No changes needed here, remains full height */
        }
        .logo-container {
          top: 10px;
          left: 10px;
          padding: 5px;
        }
        .logo-container img {
          height: 40px;
        }
        .search-bar {
          top: 10px; /* Adjust for smaller screens */
          right: 10px; /* Adjust for smaller screens */
          padding: 8px;
        }
        .search-bar.expanded {
          width: 95%; /* Adjusted expanded width for mobile */
        }
        .search-bar input {
          font-size: 0.9rem;
        }
        .search-bar button {
          padding: 0.4rem 0.8rem;
          font-size: 0.9rem;
        }
        .search-icon-toggle {
          width: 40px; /* Slightly smaller icon on mobile */
          height: 40px;
        }
      }
    </style>
  </head>
  <body>
    <div class="logo-container">
      <img
        src="https://placehold.co/50x50/cccccc/333333?text=LOGO"
        alt="Logo Perusahaan"
        onerror="this.onerror=null; this.src='https://placehold.co/50x50/cccccc/333333?text=LOGO';"
      />
    </div>

    <div class="map-wrapper">
      <div class="search-bar" id="searchBar">
        <button id="searchIconToggle" class="search-icon-toggle action-button">
          <i class="fas fa-search"></i>
        </button>
        <input
          type="text"
          id="searchInput"
          placeholder="Cari nama lokasi..."
          class="hidden"
        />
        <button id="searchButton" class="search-button hidden">Cari</button>
        <button id="clearSearchButton" class="clear-search-button hidden">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="map-container" id="mapContainer">
        <div class="map-content-wrapper" id="mapContentWrapper">
          <img
            src="img/maps.svg"
            alt="Peta Interaktif"
            class="map-image"
            id="mapImage"
          />
          <div id="mapPointsContainer"></div>
        </div>
      </div>
      <div class="zoom-controls">
        <button class="action-button" id="zoomInButton" title="Perbesar">
          <i class="fas fa-plus"></i>
        </button>
        <button class="action-button" id="zoomOutButton" title="Perkecil">
          <i class="fas fa-minus"></i>
        </button>
        <button
          class="action-button"
          id="resetViewButton"
          title="Atur Ulang Tampilan"
        >
          <i class="fas fa-arrows-rotate"></i>
        </button>
      </div>
    </div>

    <div class="detail-card-overlay" id="detailCardOverlay"></div>
    <div class="detail-card" id="detailCard">
      <button class="close-button" id="closeDetailCard">&times;</button>
      <img class="detail-image" id="detailImage" src="" alt="Gambar Lokasi" />
      <h2 class="text-2xl font-bold text-gray-800" id="detailTitle"></h2>
      <p class="text-gray-600" id="detailDescription"></p>
      <div class="social-links" id="detailSocialLinks"></div>
      <p class="phone-number" id="detailPhoneNumber"></p>
      <!-- Renamed the button ID to be more generic -->
      <button class="action-button" id="actionButton">
        <!-- Initial text will be set dynamically by JS -->
      </button>
      <div class="loading-spinner" id="loadingSpinner"></div>
    </div>

    <div class="message-box" id="messageBox"></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Define your map points with their coordinates (as percentages relative to the image) and details.
        // Adjust 'x' and 'y' values based on where you want your points to appear on your map image.
        const mapPoints = [
          {
            id: "point-ex",
            x: 30,
            y: 23, // Updated for grid layout
            name: "Pusat Pentas Seni",
            description:
              "Lokasi di adakanya kegiatan pentas seni, maupun penampilan dari tamu undangan.",
            imageUrl:
              "https://pariwisatakukar.wordpress.com/wp-content/uploads/2024/09/sam_5212.jpg",
            socialMedia: [
              {
                platform: "Situs Web",
                url: "https://www.instagram.com/visitingkutaikartanegara/",
              },
            ],
            phoneNumber: "085252451549",
            menuUrl: "",
            eventUrl: "https://example.com/event-pentas-seni", // Added event URL for point-ex
            iconUrl: "https://placehold.co/32x32/4CAF50/FFFFFF?text=STG",
            shape: "circle", // New property for circular point
          },
          {
            id: "point1",
            x: 35,
            y: 30, // Updated for grid layout
            name: "JASUKE AYS",
            description:
              "Sebuah kafe nyaman yang terletak di antara pepohonan kuno, menyajikan minuman ajaib. Sempurna untuk sore yang tenang.",
            imageUrl:
              "https://lh3.googleusercontent.com/IFEurODw36inrzj_U6v0Da3mYPcQBJ3z2izQJ4VuTwDw89REKZ1ySk4H0U00_7Pc=w600", // Placeholder image
            socialMedia: [
              {
                platform: "Instagram",
                url: "https://www.instagram.com/jasuke_ays/",
              },
            ],
            phoneNumber: "081345066284",
            menuUrl: "https://www.instagram.com/jasuke_ays/p/DBf7S4ZT-XH/", // Example PDF menu
            iconUrl: "https://placehold.co/32x32/FF0000/FFFFFF?text=P1", // Placeholder icon for point 1
          },
          {
            id: "point2",
            x: 40,
            y: 30, // Updated for grid layout
            name: "Resor Danau Kristal",
            description:
              "Sebuah resor mewah di tepi danau yang masih alami, menawarkan pemandangan menakjubkan dan santapan lezat. Nikmati olahraga air dan malam yang tenang.",
            imageUrl:
              "https://placehold.co/400x180/64b5f6/ffffff?text=Gambar+Resor",
            socialMedia: [
              {
                platform: "Twitter",
                url: "https://twitter.com/crystallakeresort",
              },
            ],
            phoneNumber: "+1-555-0102",
            menuUrl:
              "https://placehold.co/800x600/FF0000/FFFFFF.png?text=Gambar+Menu+Resor", // Example image menu
            iconUrl: "https://placehold.co/32x32/00FF00/000000?text=P2", // Placeholder icon for point 2
          },
          {
            id: "point3",
            x: 45,
            y: 30, // Updated for grid layout
            name: "Observatorium Puncak Naga",
            description:
              "An ancient observatory at the highest mountain, perfect for stargazing. Witness celestial wonders from a unique vantage point.",
            imageUrl:
              "https://placehold.co/400x180/ef5350/ffffff?text=Observatorium",
            socialMedia: [], // No social media for this point
            phoneNumber: "N/A",
            menuUrl: "", // No menu for this point
            iconUrl: "https://placehold.co/32x32/0000FF/FFFFFF?text=P3", // Placeholder icon for point 3
          },
          {
            id: "point4",
            x: 50,
            y: 30, // Updated for grid layout
            name: "Rumah Makan Kota Tenggelam",
            description:
              "Restoran unik yang dibangun di tengah reruntuhan, menyajikan masakan bawah air eksotis. Petualangan kuliner menanti!",
            imageUrl:
              "https://placehold.co/400x180/ab47bc/ffffff?text=Gambar+Rumah+Makan",
            socialMedia: [
              { platform: "Situs Web", url: "https://example.com/eatery" },
            ],
            phoneNumber: "+1-555-0104",
            menuUrl:
              "https://placehold.co/800x600/00FF00/000000.png?text=Gambar+Menu+Rumah+Makan",
            iconUrl: "https://placehold.co/32x32/FFFF00/000000?text=P4", // Placeholder icon for point 4
          },
          {
            id: "point5",
            x: 55,
            y: 30, // Updated for grid layout
            name: "Bazar Pasir Bergeser",
            description:
              "Pasar yang ramai di gurun, menawarkan barang langka dan makanan lezat lokal. Harta karun penemuan unik.",
            imageUrl:
              "https://placehold.co/400x180/ffb74d/ffffff?text=Gambar+Bazar",
            socialMedia: [
              { platform: "Blog", url: "https://blog.example.com/sandsbazaar" },
              {
                platform: "Pinterest",
                url: "https://pinterest.com/shiftingsandsbazaar",
              },
            ],
            phoneNumber: "+1-555-0105",
            menuUrl:
              "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf", // Another example PDF
            iconUrl: "https://placehold.co/32x32/FFA500/FFFFFF?text=P5", // Placeholder icon for point 5
          },
          {
            id: "point6",
            x: 60,
            y: 30, // Updated for grid layout
            name: "Permata Tersembunyi",
            description:
              "Tempat misterius dan jarang ditemukan, menawarkan ketenangan yang unik.",
            imageUrl:
              "https://placehold.co/400x180/78909c/ffffff?text=Permata+Tersembunyi",
            socialMedia: [],
            phoneNumber: "N/A",
            menuUrl: "",
            iconUrl: "https://placehold.co/32x32/800080/FFFFFF?text=P6", // Placeholder icon for new point
          },
          {
            id: "point8",
            x: 65,
            y: 30, // Updated for grid layout
            name: "Galeri Seni Sungai",
            description:
              "Galeri yang menampilkan seni lokal yang terinspirasi oleh sungai. Tempat yang sempurna untuk menemukan permata tersembunyi.",
            imageUrl:
              "https://placehold.co/400x180/a1887f/ffffff?text=Galeri+Seni",
            socialMedia: [
              {
                platform: "Instagram",
                url: "https://instagram.com/riverartgallery",
              },
            ],
            phoneNumber: "+1-555-0107",
            menuUrl: "",
            iconUrl: "https://placehold.co/32x32/795548/FFFFFF?text=P7",
          },
          {
            id: "point9",
            x: 35,
            y: 22, // Updated for grid layout
            name: "Pisang Gapit Suryani",
            description: "Taman yang luas dPisang Gapit Suryani.",
            imageUrl:
              "https://lh3.googleusercontent.com/s5JElu7ho6YBoOFP0Vk1ejD08B0zqSDb9PCrT0IXoEbimegzwO1kxIe_6tr4yRU=w600",
            socialMedia: [
              {
                platform: "Instagram",
                url: "hhttps://www.instagram.com/pisanggapitsuryani",
              },
            ],
            phoneNumber: "",
            menuUrl: "https://www.instagram.com/p/C_EgQk3Tj0K",
            iconUrl: "https://placehold.co/32x32/689F38/FFFFFF?text=P9",
          },
          {
            id: "point10",
            x: 40,
            y: 22, // Updated for grid layout
            name: "Pusat Sejarah Kota",
            description:
              "Pelajari tentang sejarah kota yang kaya di pusat yang informatif ini.",
            imageUrl:
              "https://placehold.co/400x180/78909c/ffffff?text=Pusat+Sejarah",
            socialMedia: [],
            phoneNumber: "+1-555-0109",
            iconUrl: "https://placehold.co/32x32/546E7A/FFFFFF?text=P10",
          },
          {
            id: "point11",
            x: 45,
            y: 22, // Updated for grid layout
            name: "Toko Buku Tua",
            description: "Jelajahi harta karun sastra di toko buku antik ini.",
            imageUrl:
              "https://placehold.co/400x180/d4e157/ffffff?text=Toko+Buku",
            socialMedia: [
              {
                platform: "Facebook",
                url: "https://facebook.com/oldbookstore",
              },
            ],
            phoneNumber: "+1-555-0110",
            menuUrl: "",
            iconUrl: "https://placehold.co/32x32/C0CA33/000000?text=P11",
          },
          {
            id: "point12",
            x: 50,
            y: 22, // Updated for grid layout
            name: "Taman Petualangan",
            description:
              "Taman hiburan dengan wahana mendebarkan dan aktivitas untuk segala usia.",
            imageUrl:
              "https://placehold.co/400x180/ff7043/ffffff?text=Taman+Petualangan",
            socialMedia: [
              {
                platform: "Situs Web",
                url: "https://example.com/adventurepark",
              },
            ],
            phoneNumber: "+1-555-0111",
            menuUrl: "",
            iconUrl: "https://placehold.co/32x32/F4511E/FFFFFF?text=P12",
          },
          {
            id: "point13",
            x: 55,
            y: 22, // Updated for grid layout
            name: "Taman Petualangan",
            description:
              "Taman hiburan dengan wahana mendebarkan dan aktivitas untuk segala usia.",
            imageUrl:
              "https://placehold.co/400x180/ff7043/ffffff?text=Taman+Petualangan",
            socialMedia: [
              {
                platform: "Situs Web",
                url: "https://example.com/adventurepark",
              },
            ],
            phoneNumber: "+1-555-0111",
            menuUrl: "",
            iconUrl: "https://placehold.co/32x32/F4511E/FFFFFF?text=P13",
          },
          {
            id: "point14",
            x: 60,
            y: 22, // Updated for grid layout
            name: "Taman Petualangan",
            description:
              "Taman hiburan dengan wahana mendebarkan dan aktivitas untuk segala usia.",
            imageUrl:
              "https://placehold.co/400x180/ff7043/ffffff?text=Taman+Petualangan",
            socialMedia: [
              {
                platform: "Situs Web",
                url: "https://example.com/adventurepark",
              },
            ],
            phoneNumber: "+1-555-0111",
            menuUrl: "",
            iconUrl: "https://placehold.co/32x32/F4511E/FFFFFF?text=P14",
          },
          {
            id: "point15",
            x: 65,
            y: 22, // Updated for grid layout
            name: "Taman Petualangan",
            description:
              "Taman hiburan dengan wahana mendebarkan dan aktivitas untuk segala usia.",
            imageUrl:
              "https://placehold.co/400x180/ff7043/ffffff?text=Taman+Petualangan",
            socialMedia: [
              {
                platform: "Situs Web",
                url: "https://example.com/adventurepark",
              },
            ],
            phoneNumber: "+1-555-0111",
            menuUrl: "",
            iconUrl: "https://placehold.co/32x32/F4511E/FFFFFF?text=P15",
          },
        ];

        const mapImage = document.getElementById("mapImage");
        const mapContainer = document.getElementById("mapContainer");
        const mapPointsContainer =
          document.getElementById("mapPointsContainer");
        const detailCard = document.getElementById("detailCard");
        const detailCardOverlay = document.getElementById("detailCardOverlay");
        const detailImage = document.getElementById("detailImage");
        const detailTitle = document.getElementById("detailTitle");
        const detailDescription = document.getElementById("detailDescription");
        const detailSocialLinks = document.getElementById("detailSocialLinks");
        const detailPhoneNumber = document.getElementById("detailPhoneNumber");
        const closeDetailCardButton =
          document.getElementById("closeDetailCard");
        const actionButtonElement = document.getElementById("actionButton"); // Changed ID here
        const loadingSpinner = document.getElementById("loadingSpinner");
        const messageBox = document.getElementById("messageBox");

        const searchBar = document.getElementById("searchBar");
        const searchIconToggle = document.getElementById("searchIconToggle");
        const searchInput = document.getElementById("searchInput");
        const searchButton = document.getElementById("searchButton");
        const clearSearchButton = document.getElementById("clearSearchButton");

        const zoomInButton = document.getElementById("zoomInButton");
        const zoomOutButton = document.getElementById("zoomOutButton");
        const resetViewButton = document.getElementById("resetViewButton");

        let currentPointData = null;
        let currentZoom = 1.0;
        const zoomStep = 0.2;
        const maxZoom = 3.0;
        const minZoom = 1.0;
        let currentLocationMarker = null; // Still needed if other parts of the code refer to it

        let originalMapRenderedWidth = 0;
        let originalMapRenderedHeight = 0;

        // Panning variables
        let isDragging = false;
        let startX, startY;
        let scrollLeftStart, scrollTopStart;

        // Pinch-to-zoom variables
        let initialPinchDistance = null;
        let initialZoom = 1.0;

        /**
         * Calculates the Euclidean distance between two touch points.
         * @param {Touch} touch1 - The first touch object.
         * @param {Touch} touch2 - The second touch object.
         * @returns {number} The distance between the two touches.
         */
        function getDistance(touch1, touch2) {
          const dx = touch1.clientX - touch2.clientX;
          const dy = touch1.clientY - touch2.clientY;
          return Math.sqrt(dx * dx + dy * dy);
        }

        /**
         * Displays a temporary message box at the bottom of the screen.
         * @param {string} message - The message to display.
         * @param {number} duration - How long the message will be displayed in milliseconds.
         */
        function showMessage(message, duration = 3000) {
          messageBox.textContent = message;
          messageBox.classList.add("active");
          setTimeout(() => {
            messageBox.classList.remove("active");
          }, duration);
        }

        /**
         * Applies the current zoom level by resizing the map content wrapper.
         */
        function applyZoom() {
          if (!mapContentWrapper || originalMapRenderedWidth === 0) return;

          // Set wrapper width and height based on zoom
          mapContentWrapper.style.width = `${
            originalMapRenderedWidth * currentZoom
          }px`;
          mapContentWrapper.style.height = `${
            originalMapRenderedHeight * currentZoom
          }px`;

          // Ensure mapPointsContainer also scales with the content wrapper
          mapPointsContainer.style.width = `${
            originalMapRenderedWidth * currentZoom
          }px`;
          mapPointsContainer.style.height = `${
            originalMapRenderedHeight * currentZoom
          }px`;

          console.log(
            `Zoom applied: ${currentZoom}, Wrapper size: ${mapContentWrapper.style.width}x${mapContentWrapper.style.height}`
          );
        }

        /**
         * Increases the map zoom level.
         */
        function zoomIn() {
          if (currentZoom < maxZoom) {
            currentZoom = Math.min(maxZoom, currentZoom + zoomStep);
            applyZoom();
          }
        }

        /**
         * Decreases the map zoom level.
         */
        function zoomOut() {
          if (currentZoom > minZoom) {
            currentZoom = Math.max(minZoom, currentZoom - zoomStep);
            applyZoom();
          }
        }

        /**
         * Resets the map zoom level to its initial state (1.0) and removes any markers.
         */
        function resetView() {
          currentZoom = 1.0;
          applyZoom();
          removeCurrentLocationMarker();
          // Also reset scroll position
          mapContainer.scrollLeft = 0;
          mapContainer.scrollTop = 0;
        }

        /**
         * Adds a marker to the map at the specified coordinates.
         * @param {number} lat - Latitude.
         * @param {number} lon - Longitude.
         * @param {string} type - Type of marker (e.g., 'current-location').
         */
        function addMarker(lat, lon, type) {
          // For a static image map, converting lat/lon to x/y percentages
          // requires knowledge of the exact geographical bounds of your map image.
          // For this example, we'll place it in the center for demonstration.
          // You would replace this with actual logic if your map image corresponds to real-world coordinates.
          const xPercent = 50; // Example: Center X
          const yPercent = 50; // Example: Center Y

          removeCurrentLocationMarker(); // Ensures only one current location marker exists

          currentLocationMarker = document.createElement("div");
          currentLocationMarker.classList.add("current-location-marker");
          currentLocationMarker.style.left = `${xPercent}%`;
          currentLocationMarker.style.top = `${yPercent}%`;
          mapPointsContainer.appendChild(currentLocationMarker);
          showMessage("Your approximate location is marked on the map.", 4000);

          // Optionally, zoom to the location
          // currentZoom = 1.5; // Zoom in slightly
          // applyZoom();
          // You might also want to pan the map to center the marker:
          // mapContainer.scrollLeft = (mapContentWrapper.offsetWidth * xPercent / 100) - (mapContainer.offsetWidth / 2);
          // mapContainer.scrollTop = (mapContentWrapper.offsetHeight * yPercent / 100) - (mapContainer.offsetHeight / 2);
        }

        /**
         * Removes the current location marker from the map.
         */
        function removeCurrentLocationMarker() {
          if (
            currentLocationMarker &&
            mapPointsContainer.contains(currentLocationMarker)
          ) {
            mapPointsContainer.removeChild(currentLocationMarker);
            currentLocationMarker = null;
          }
        }

        /**
         * Closes the detail information card.
         */
        function closeDetailCard() {
          detailCard.classList.remove("active");
          detailCardOverlay.classList.remove("active");
          loadingSpinner.classList.remove("active"); // Hide spinner when closing
          actionButtonElement.disabled = false; // Re-enable button
          actionButtonElement.innerHTML = ""; // Reset button text
          actionButtonElement.onclick = null; // Clear click handler
          detailImage.src = ""; // Clear image source
          detailImage.alt = ""; // Clear image alt text
          detailSocialLinks.innerHTML = ""; // Clear social links
          detailPhoneNumber.textContent = ""; // Clear phone number
        }

        /**
         * Displays the detail information card with data for a specific point.
         * @param {Object} pointData - The data object for the clicked map point.
         */
        function showDetailCard(pointData) {
          currentPointData = pointData; // Store current point data

          // Set image
          detailImage.src =
            pointData.imageUrl ||
            "https://placehold.co/400x180/cccccc/333333?text=Tidak+Ada+Gambar"; // Fallback image
          detailImage.alt = `Gambar ${pointData.name}`;

          detailTitle.textContent = pointData.name;
          detailDescription.textContent = pointData.description; // Display initial description

          // Populate social media links
          detailSocialLinks.innerHTML = ""; // Clear previous links
          if (pointData.socialMedia && pointData.socialMedia.length > 0) {
            pointData.socialMedia.forEach((link) => {
              const anchor = document.createElement("a");
              anchor.href = link.url;
              anchor.textContent = link.platform;
              anchor.target = "_blank"; // Open in new tab
              anchor.classList.add("social-link");
              detailSocialLinks.appendChild(anchor);
            });
          } else {
            detailSocialLinks.textContent =
              "Tidak ada tautan media sosial yang tersedia.";
            detailSocialLinks.classList.add("text-gray-500", "text-sm"); // Style for no links message
          }

          // Populate phone number
          detailPhoneNumber.textContent = `Telepon: ${
            pointData.phoneNumber || "N/A"
          }`;

          // Set action button status and link dynamically based on point type
          if (pointData.id === "point-ex") {
            // For 'point-ex', prioritize 'eventUrl'
            if (pointData.eventUrl && pointData.eventUrl.trim() !== "") {
              actionButtonElement.disabled = false;
              actionButtonElement.innerHTML =
                '<i class="fas fa-calendar-alt"></i> Lihat Event';
              actionButtonElement.onclick = () =>
                window.open(pointData.eventUrl, "_blank");
            } else {
              // If 'point-ex' has no event URL, check for menu URL as a fallback for this specific point
              if (pointData.menuUrl && pointData.menuUrl.trim() !== "") {
                actionButtonElement.disabled = false;
                actionButtonElement.innerHTML =
                  '<i class="fas fa-utensils"></i> Lihat Menu';
                actionButtonElement.onclick = () =>
                  window.open(pointData.menuUrl, "_blank");
              } else {
                actionButtonElement.disabled = true;
                actionButtonElement.innerHTML =
                  '<i class="fas fa-info-circle"></i> Tidak Ada Event/Menu';
                actionButtonElement.onclick = null; // Clear previous click handler
              }
            }
          } else {
            // For all other points, use 'menuUrl' logic
            if (pointData.menuUrl && pointData.menuUrl.trim() !== "") {
              actionButtonElement.disabled = false;
              actionButtonElement.innerHTML =
                '<i class="fas fa-utensils"></i> Lihat Menu';
              actionButtonElement.onclick = () =>
                window.open(pointData.menuUrl, "_blank");
            } else {
              actionButtonElement.disabled = true;
              actionButtonElement.innerHTML =
                '<i class="fas fa-utensils"></i> Tidak Ada Menu';
              actionButtonElement.onclick = null; // Clear previous click handler
            }
          }

          detailCard.classList.add("active");
          detailCardOverlay.classList.add("active");
          loadingSpinner.classList.remove("active"); // Ensure spinner is hidden initially
        }

        /**
         * Initializes the map by creating and placing points.
         * This function runs after the map image is loaded to ensure correct positioning.
         * @param {Array} pointsToRender - The array of points to render. Defaults to `mapPoints` if not provided.
         */
        function initializeMapPoints(pointsToRender = mapPoints) {
          // Create mapContentWrapper if it doesn't exist or if it was removed (e.g., on resize)
          if (!mapContentWrapper || !mapContainer.contains(mapContentWrapper)) {
            mapContentWrapper = document.getElementById("mapContentWrapper"); // Get existing wrapper
            if (!mapContentWrapper) {
              // If it doesn't exist, create it
              mapContentWrapper = document.createElement("div");
              mapContentWrapper.id = "mapContentWrapper";
              mapContentWrapper.style.position = "relative"; // Important for absolute positioning of points
              mapContentWrapper.style.width = "100%"; // Start at 100% of container
              mapContentWrapper.style.height = "auto"; // Start at auto height
              mapContainer.appendChild(mapContentWrapper);

              // Move mapImage and mapPointsContainer into mapContentWrapper
              // Ensure mapImage and mapPointsContainer are detached from their current parent first
              if (mapImage.parentNode)
                mapImage.parentNode.removeChild(mapImage);
              if (mapPointsContainer.parentNode)
                mapPointsContainer.parentNode.removeChild(mapPointsContainer);

              mapContentWrapper.appendChild(mapImage);
              mapContentWrapper.appendChild(mapPointsContainer);
            }
          }

          // Get original rendered dimensions only once, or re-get on resize if necessary
          // This needs to be done when the image is at its unzoomed (1.0) state for accurate measurements
          // Temporarily set zoom to 1.0 to get accurate base dimensions for measurement
          const tempZoom = currentZoom;
          currentZoom = 1.0;
          mapContentWrapper.style.width = "100%"; // Reset wrapper to base size for measurement
          mapContentWrapper.style.height = "auto";
          mapImage.style.width = "100%"; // Ensure image is at base size for measurement
          mapImage.style.height = "auto";

          // Use requestAnimationFrame to ensure layout is updated before measurement
          requestAnimationFrame(() => {
            originalMapRenderedWidth = mapImage.offsetWidth;
            originalMapRenderedHeight = mapImage.offsetHeight;
            console.log(
              `Original Rendered Map Dimensions: ${originalMapRenderedWidth}x${originalMapRenderedHeight}`
            );

            // Restore original zoom or apply initial zoom
            currentZoom = tempZoom;
            applyZoom(); // Apply the actual current zoom

            // Now populate the points, they will be positioned relative to mapPointsContainer
            // which is now correctly sized by applyZoom
            mapPointsContainer.innerHTML = ""; // Clear existing points if any
            pointsToRender.forEach((point, index) => {
              const pointElement = document.createElement("div");
              pointElement.classList.add("map-point");
              // Add 'circle' class only if its id is 'point-ex' or if shape is explicitly 'circle'
              if (point.id === "point-ex" || point.shape === "circle") {
                pointElement.classList.add("circle");
              }
              pointElement.style.left = `${point.x}%`;
              pointElement.style.top = `${point.y}%`;

              // Create image element for the icon
              const iconImage = document.createElement("img");
              iconImage.src =
                point.iconUrl ||
                `https://placehold.co/32x32/cccccc/333333?text=P${index + 1}`; // Fallback icon
              iconImage.alt = `Icon ${point.name}`;
              pointElement.appendChild(iconImage); // Add image to the point

              pointElement.addEventListener("click", (e) => {
                // Stop propagation to prevent panning when clicking on a point
                e.stopPropagation();
                showDetailCard(point);
              });
              mapPointsContainer.appendChild(pointElement);
            });
          });
        }

        // Function to expand the search bar
        function expandSearchBar() {
          searchBar.classList.add("expanded");
          searchIconToggle.classList.add("hidden");
          searchInput.classList.remove("hidden");
          searchButton.classList.remove("hidden");
          clearSearchButton.classList.remove("hidden");
          searchInput.focus(); // Focus on the input when expanded
        }

        // Function to collapse the search bar
        function collapseSearchBar() {
          if (searchInput.value.trim() === "") {
            // Only collapse if input is empty
            searchBar.classList.remove("expanded");
            searchIconToggle.classList.remove("hidden");
            searchInput.classList.add("hidden");
            searchButton.classList.add("hidden");
            clearSearchButton.classList.add("hidden");
          }
        }

        /**
         * Filters map points based on search input and re-renders the map.
         */
        function performSearch() {
          const searchTerm = searchInput.value.toLowerCase().trim();
          if (searchTerm === "") {
            initializeMapPoints(mapPoints); // Show all points if search is empty
            collapseSearchBar(); // Collapse if search is empty
            return;
          }

          const filteredPoints = mapPoints.filter((point) =>
            point.name.toLowerCase().includes(searchTerm)
          );

          if (filteredPoints.length > 0) {
            initializeMapPoints(filteredPoints);
            showMessage(
              `Ditemukan ${filteredPoints.length} lokasi yang cocok.`,
              3000
            );
          } else {
            initializeMapPoints([]); // Clear all points if no match
            showMessage("Tidak ada lokasi yang cocok ditemukan.", 3000);
          }
          // Don't collapse after search, keep results visible unless cleared
        }

        /**
         * Clears the search input and resets the map to show all points.
         */
        function clearSearch() {
          searchInput.value = "";
          initializeMapPoints(mapPoints);
          showMessage("Pencarian dibersihkan. Semua lokasi ditampilkan.", 3000);
          collapseSearchBar(); // Collapse after clearing
        }

        // Event listeners for zoom buttons
        closeDetailCardButton.addEventListener("click", closeDetailCard);
        detailCardOverlay.addEventListener("click", closeDetailCard);

        zoomInButton.addEventListener("click", zoomIn);
        zoomOutButton.addEventListener("click", zoomOut);
        resetViewButton.addEventListener("click", resetView);

        // Event listeners for search buttons and input
        searchIconToggle.addEventListener("click", expandSearchBar);
        searchButton.addEventListener("click", performSearch);
        clearSearchButton.addEventListener("click", clearSearch);
        searchInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            performSearch();
          }
        });
        searchInput.addEventListener("blur", collapseSearchBar); // Collapse on blur if empty

        // Initial setup when image loads or is already cached
        mapImage.onload = () => {
          initializeMapPoints();
        };

        if (mapImage.complete) {
          initializeMapPoints();
        }

        // Re-initialize and re-measure on window resize
        window.addEventListener("resize", () => {
          // Remove existing mapContentWrapper to force re-creation and re-measurement
          if (mapContentWrapper && mapContainer.contains(mapContentWrapper)) {
            mapContainer.removeChild(mapContentWrapper);
            mapContentWrapper = null; // Reset reference
          }
          // Reset zoom to 1.0 before re-initializing to get accurate base dimensions for new window size
          currentZoom = 1.0;
          initializeMapPoints();
        });
      }); // End DOMContentLoaded
    </script>
  </body>
</html>
